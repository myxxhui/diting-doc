# L3 · Stage1-04 密钥与配置模板设计

> [!NOTE] **[TRACEBACK] 原子规约锚点**
> - **战略维度**: [安全与机密治理维度](../../02_战略维度/产品设计/05_安全与机密治理维度.md)、[开发与交付流程维度](../../02_战略维度/开发与交付/01_开发与交付流程维度.md)
> - **原子规约**: [_共享规约/02_三位一体仓库规约](../_共享规约/02_三位一体仓库规约.md)、[开发与交付/02_基础设施与部署规约](../开发与交付/02_基础设施与部署规约.md)
> - **DNA**: [_System_DNA/Stage1_仓库与骨架/dna_stage1_04.yaml](../_System_DNA/Stage1_仓库与骨架/dna_stage1_04.yaml)
> - **L4 实践**: [04_阶段规划与实践/Stage1_仓库与骨架/04_密钥与配置模板就绪](../../04_阶段规划与实践/Stage1_仓库与骨架/04_密钥与配置模板就绪.md#l4-stage1-04-exit)
> - **L5 锚点**: [02_验收标准#l5-stage-stage1_04](../../05_成功标识与验证/02_验收标准.md#l5-stage-stage1_04)

<a id="design-stage1-04-goal"></a>
## 本步目标

密钥与配置模板就绪；引入 Sealed-Secrets；diting-infra secrets/ 含模板与说明；.env.template 双仓占位（不含真实 Key）；config 为单一 YAML 模板可用。

<a id="design-stage1-04-points"></a>
## 设计要点

- **Sealed-Secrets**：diting-infra 使用官方最新稳定版 Chart，放置于约定路径（如 `charts/dependencies/sealed-secrets`）；secrets/ 使用 Sealed-Secrets 加密 YAML 或 Helm 引用；明文不进入 Git。验证分两级：Stage1 至少执行 **helm template** 检查关键 values 生效；集群内验证在基础设施就绪后进行。
- **config**：符合 deploy-engine DeploymentConfig；**单一 YAML**（如 `config/environments/dev/deploy.yaml`）为真相源。
- **密钥来源**：见 02_三位一体、02_基础设施与部署规约；sealing key 由集群管理员管理。
- **.env.template**：diting-core 与 diting-infra 均放置；应用相关以 diting-core 为权威，diting-infra 可多出 infra 专用项。

<a id="design-stage1-04-exit"></a>
## 准出

secrets/ 含 Sealed-Secrets 模板或说明；.env.template 双仓占位；config 单一 YAML 模板可用；Chart 模板参数、deploy-engine 符合性、Git 引用 deploy-engine 三项验证通过。
