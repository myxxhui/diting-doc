# Stage2-01 基础设施与依赖部署

> [!NOTE] **[TRACEBACK] 步骤锚点**
> - **原子规约**: [_共享规约/11_数据采集与输入层规约](../../03_原子目标与规约/_共享规约/11_数据采集与输入层规约.md)
> - **DNA stage_id**: `stage2_01`
> - **本步设计文档**: [01_基础设施与依赖设计](../../03_原子目标与规约/Stage2_数据采集与存储/01_基础设施与依赖设计.md#design-stage2-01-exit)
> - **本步 DNA 文件**: [dna_stage2_01.yaml](../../03_原子目标与规约/_System_DNA/Stage2_数据采集与存储/dna_stage2_01.yaml)

<a id="l4-step-nav"></a>
## 步骤导航
- **上一步**：[04_密钥与配置模板就绪](../Stage1_仓库与骨架/04_密钥与配置模板就绪.md#l4-stage1-04-goal)
- **下一步**：[02_采集逻辑与Dockerfile](02_采集逻辑与Dockerfile.md#l4-stage2-02-goal)

## 工作目录

**diting-infra**（Chart、init Job）

## 环境

- **Minimal**：本地或轻量部署
- **Full**：K3s 全栈

<a id="l4-stage2-01-goal"></a>
## 本步目标

TimescaleDB、Redis、PostgreSQL 部署；Schema init Job 执行建表；Sealed-Secrets 就绪。初期本地连 K3s（NodePort），后期 K3s Job。

## 核心指令

```
你是在 diting-infra 中执行 Stage2-01（基础设施与依赖部署）的实践者。必读：03_原子目标与规约/_共享规约/11_数据采集与输入层规约.md、03_原子目标与规约/开发与交付/02_基础设施与部署规约.md、global_const.data_architecture。

任务：
1. 建立基础组件 Chart（TimescaleDB、Redis、PostgreSQL）。
2. 实现 Schema init Job，执行建表（schemas/sql 定义）；严禁在应用代码中执行 DDL。
3. 确认 Sealed-Secrets 可用；密钥注入由 Sealed-Secrets 完成。
```

<a id="l4-stage2-01-exit"></a>
## 验证与准出

TimescaleDB/Redis/PostgreSQL 可用；Schema init Job 成功；Sealed-Secrets 可用。**已更新 L5 [02_验收标准 对应行](../../05_成功标识与验证/02_验收标准.md#l5-stage-stage2_01)**。
