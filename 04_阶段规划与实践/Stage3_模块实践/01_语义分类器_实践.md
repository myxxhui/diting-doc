# Stage3-01 Module A 语义分类器

> [!NOTE] **[TRACEBACK] 步骤锚点**
> - **顶层概念**: [一句话定义与核心价值](../../01_顶层概念/01_一句话定义与核心价值.md)
> - **战略维度**: [01_产品设计维度](../../02_战略维度/产品设计/01_产品设计维度.md)
> - **原子规约**: [_共享规约/09_核心模块架构规约](../../03_原子目标与规约/_共享规约/09_核心模块架构规约.md)（Module A）、[ClassifierOutput Proto](../../03_原子目标与规约/_Design_Artifacts/protocols/classifier/classifier_output.proto)
> - **DNA stage_id**: `stage3_01`
> - **本步设计文档**: [01_语义分类器_设计](../../03_原子目标与规约/Stage3_模块实践/01_语义分类器_设计.md#design-stage3-01-exit)
> - **本步 DNA 文件**: [01_dna_语义分类器.yaml](../../03_原子目标与规约/_System_DNA/Stage3_模块实践/01_dna_语义分类器.yaml)、[core_modules/dna_module_a.yaml](../../03_原子目标与规约/_System_DNA/core_modules/dna_module_a.yaml)
> - **阶段**: [Phase1_按模块实践](README.md)

<a id="l4-step-nav"></a>
## 步骤导航
- **上一步**：[05_采集模块部署与验收_实践](../Stage2_数据采集与存储/05_采集模块部署与验收_实践.md#l4-stage2-05-goal)
- **下一步**：[02_量化扫描引擎_实践](02_量化扫描引擎_实践.md#l4-stage3-02-goal)

> [!IMPORTANT] **实践测试方式约定**
> 本步以**本地 Docker Compose**（或等价本地环境）为**主要（默认）**实践测试方式，可选 K3s/实盘；无云凭证或无需真实集群时**优先**使用本地 Compose 完成验收。见 [00_系统规则_通用项目协议](../../00_系统规则_通用项目协议.md)、[02_三位一体仓库规约](../../03_原子目标与规约/_共享规约/02_三位一体仓库规约.md)#本地开发与部署文件。

---

## 上下游关系总览

本步**消耗** Stage2-05 准出（采集模块部署、L1/L2 可用、行业/营收数据可写入并可被下游读取）；**产出** Module A 语义分类器实现（`diting/classifier` 包、`config/classifier_rules.yaml`、单测与四项 100% 验证），供 Stage3-02（量化扫描引擎）、Stage3-03（MoE 议会）及热路径 A→F 全链路使用。

---

## 工作目录

**diting-core**（与 DNA `work_dir` / `repo_i` 一致）

---

<a id="l4-stage3-01-goal"></a>
## 本步骤目标

实现 Module A 语义分类器，满足 09_ 规约的输入/输出与分类规则；完成 **四项 100% 验证**（接口、结构、逻辑功能、代码测试），并支持单模块验证、与 B/D 联动验证及全链路验证。

---

## 本步骤落实的 _System_DNA 键

| DNA 键 | 用途 |
|--------|------|
| `01_dna_语义分类器.yaml` | stage_id、work_dir、delivery_scope、exit_criteria、l5_stage_anchor、consumes、artifacts、semantic_ref |
| `core_modules/dna_module_a.yaml` | `module_a_semantic_classifier.purpose`、`input`、`output`、`classification_rules`（agri/tech/geo 规则描述） |

---

<a id="l4-stage3-01-deps-check"></a>
## 本步依赖检查与数据来源

执行本步前，须确认以下依赖与数据来源可用。

### 1. 上游准出

| 检查项 | 说明 | 本步用途 |
|--------|------|----------|
| **Stage2-05 准出** | 采集模块已部署；`make ingest-test` 可写 L1/L2；行业/营收数据可被读取 | Module A 输入：申万行业、营收占比来自 L1/L2 或 MarketDataFeed；若 s0_data 未准出可先用 Mock 验证接口与结构，标注待补验 |

### 2. 数据输入来源（与 11_ 规约一致）

| 输入项 | 来源 | 说明 |
|--------|------|------|
| 标的代码 | 调用方传入 | 如 `"000998.SZ"`、`"688981.SH"` |
| 申万行业分类 | L2 或 Stage2 采集的 industry_revenue / 约定表 | 见 [11_ 数据采集与输入层规约](../../03_原子目标与规约/_共享规约/11_数据采集与输入层规约.md)、[Stage2-02 采集逻辑与 Dockerfile](../../03_原子目标与规约/Stage2_数据采集与存储/02_采集逻辑与Dockerfile_设计.md) |
| 营收占比数据 | L2 或 Stage2 采集的 industry_revenue | 同上；逻辑填充期可从 MarketDataFeed 或 L1/L2 读取 |

**数据不可用时的策略**：先用 Mock 数据验证接口与结构、YAML 规则加载、UNKNOWN 路径；在文档中标注「待 s0_data / Stage2-05 准出后补验真实标的」。

---

<a id="l4-stage3-01-impl"></a>
## 实现要求与逻辑细节

### 1. 目录与包结构

| 要求 | 说明 | 与 DNA 一致性 |
|------|------|----------------|
| 包路径 | 在 diting-core 下建立 `diting/classifier` 包 | 与 09_ Module A、DNA delivery_scope 一致 |
| 配置路径 | 分类规则使用 YAML 配置，路径如 `config/classifier_rules.yaml`（或 DNA/设计文档约定的路径） | 规则不硬编码，可由配置驱动 |

### 2. 接口与契约

| 项目 | 要求 | 规约与设计引用 |
|------|------|----------------|
| 输入 | 标的代码、申万行业、营收占比（可从 L1/L2 或 MarketDataFeed 获取） | [09_ Module A 输入输出](../../03_原子目标与规约/_共享规约/09_核心模块架构规约.md)、[dna_module_a.input](../../03_原子目标与规约/_System_DNA/core_modules/dna_module_a.yaml) |
| 输出 | `ClassifierOutput`：Domain Tag 列表 + 置信度 (0.0–1.0) | [ClassifierOutput.proto](../../03_原子目标与规约/_Design_Artifacts/protocols/classifier/classifier_output.proto)；可被 Module B/D 消费 |
| 实现类 | `SemanticClassifier`，提供 `classify(symbol)` 或等价接口，返回符合 Proto 的输出 | 09_ 规约、设计文档 [01_语义分类器_设计](../../03_原子目标与规约/Stage3_模块实践/01_语义分类器_设计.md#design-stage3-01-points) |

### 3. 分类规则（YAML 驱动）

规则须从 **YAML 配置** 加载，禁止在代码中硬编码规则阈值与行业关键词。与 `dna_module_a.classification_rules` 语义一致：

| Domain Tag | 规则描述（DNA） | 实现要点 |
|------------|-----------------|----------|
| **AGRI** | 申万行业=农林牧渔 或 营收占比>50% | 配置中可配置行业关键词与占比阈值 |
| **TECH** | 申万行业=电子/计算机/通信 或 研发投入>10% | 同上 |
| **GEO** | 申万行业=有色金属/石油石化 或 大宗商品营收>50% | 同上 |
| **UNKNOWN** | 无法匹配上述规则 | 默认出口；置信度可用 0.5 或配置值 |

配置变更后，分类结果应随之变化（**逻辑功能 100%** 验证项之一）。

### 4. 真实标的验证约定（可选，数据就绪时必做）

| 标的示例 | 预期 Tag | 说明 |
|----------|----------|------|
| 000998.SZ（隆平高科） | AGRI | 农林牧渔 |
| 中芯国际（688981.SH 等） | TECH | 电子/半导体 |
| 紫金矿业 | GEO | 有色金属/大宗 |
| 无法归类标的 | UNKNOWN | 走 Trash Bin 路径 |

单模块验证时至少用 1～2 个真实标的（或 Mock）跑通分类结果并核对 Tag 与置信度。

### 5. 单独运行、Dockerfile、镜像与版本管理、一键构建、一键部署

Module A 为**独立可部署单元**（见 [09_ 可部署单元清单](../../03_原子目标与规约/_共享规约/09_核心模块架构规约.md)、[global_const.deployable_units.module_a](../../03_原子目标与规约/_System_DNA/global_const.yaml)），须支持单独运行、镜像构建与部署链，与 Stage2 采集模块实践方式对齐。

| 实践项 | 要求 | 与 DNA/规约一致 |
|--------|------|-----------------|
| **单独运行** | Module A 可作为独立服务运行：提供 CLI 或 HTTP/gRPC 入口（如 `python -m diting.classifier.run` 或等价）；本地或镜像内执行同一入口即可跑分类服务 | 09_ Module A 独立服务、镜像与验证链独立 |
| **Dockerfile** | 路径：`diting-core/docker/module_a`（与 `global_const.deployable_units.module_a.dockerfile_path` 一致）；多阶段构建、安装依赖、COPY 代码与 `config/classifier_rules.yaml`、设置 ENTRYPOINT/CMD；不硬编码业务密钥 | DNA dockerfile_path |
| **镜像与版本管理** | 镜像名：`diting-module-a`（可加 registry 前缀）；Tag 策略：dev 用 git-sha 或 latest、prod 用 SemVer；与 [dna_dev_workflow.release_bundle](../../03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml)（tag_strategy: git_sha_or_semver）一致；同一 Release 内与其它可部署单元同 tag | global_const.image_name、release_bundle |
| **一键构建** | Makefile 提供 `make build-module-a`（或 `make build-images` 含 module_a）；在 **diting-core** 执行，产出可运行镜像；构建后可在**镜像内**执行 `make test` 或等价验证（V-IMAGE） | 与 Stage2-02 V-BUILD-ALL、02_量化扫描引擎 V-IMAGE 对齐 |
| **一键部署** | **diting-infra** 侧 Chart：`diting-infra/charts/module_a`（与 `global_const.deployable_units.module_a.chart_path` 一致）；提供 `make deploy-module-a` 或等价 Helm 部署命令；依赖 K3s 与 Stage2-05 准出后可部署；本地开发期可用 Compose 或单容器 run 验证 | DNA chart_path；部署为可选路线，与 Stage2-05 后 K3s 部署一致 |

**说明**：镜像内须能执行分类逻辑（含加载 config/classifier_rules.yaml）；若需连 L1/L2，通过环境变量（如 `PG_L2_DSN`）或 Secret 注入，不写死镜像内。

---

## 核心指令（The Prompt）

```
你是在 diting-core 中实现 Module A 语义分类器的开发者。必读：03_原子目标与规约/_共享规约/09_核心模块架构规约.md（Module A 小节）、03_原子目标与规约/_System_DNA/core_modules/dna_module_a.yaml、03_原子目标与规约/_Design_Artifacts/protocols/classifier/classifier_output.proto（或 diting-core 内等价路径 design/protocols/classifier/classifier_output.proto）。

任务：
1. 实现 SemanticClassifier，输出符合 ClassifierOutput；接口可被 B/D 消费。
2. 分类规则写入 config/classifier_rules.yaml，不硬编码；规则与 dna_module_a.classification_rules 语义一致。
3. 单测覆盖 AGRI/TECH/GEO/UNKNOWN、边界与配置变更验证。
4. 若 s0_data/Stage2-05 已准出，用真实标的（如 000998.SZ、中芯国际、紫金矿业）验证；否则用 Mock 验证接口与结构，并标注待补验。
5. Dockerfile：在 diting-core/docker/module_a 提供 Dockerfile（与 global_const.deployable_units.module_a 一致）；镜像内可运行分类入口并执行 make test（V-IMAGE）。
6. 一键构建：Makefile 提供 make build-module-a（或 make build-images 含 module_a）；镜像与版本管理按 dna_dev_workflow.release_bundle（tag 策略 git_sha_or_semver）。
7. 一键部署（可选）：diting-infra 侧 Chart module_a 与 make deploy-module-a 或等价；可与 Stage2-05 后 K3s 部署流程一致。

工作目录：diting-core。约束：规则不硬编码；代码含 [Ref: 01_语义分类器] 或 [Ref: 09_ Module A]。

输出：变更列表、关键接口、单测命令与通过摘要、Dockerfile/构建/部署路径与验证项结果清单填写说明。
```

---

<a id="l4-stage3-01-verify-routes"></a>
## 验证路线说明

| 路线 | 说明 | 适用场景 |
|------|------|----------|
| **默认：本地单测 + 结构/接口验证** | 在 diting-core 执行 `make test`（或 `pytest diting/classifier -v --cov=diting.classifier`）；检查目录与 config 存在、Proto 生成代码可用、YAML 可加载 | 日常开发、CI、无真实 L1/L2 时 |
| **可选：真实数据验证** | 配置 .env 连接 L1/L2（或本地 Compose 提供的库），从 MarketDataFeed 或约定表读取行业/营收，对真实标的执行分类并核对 Tag | Stage2-05 准出后、需验证端到端分类正确性时 |

**填写约定**：在 [验证项与结果清单](#l4-stage3-01-verify-checklist) 的「实际输出或备注」中注明采用的路线（如「默认本地单测」或「真实数据验证」）。

---

<a id="l4-stage3-01-feature-checklist"></a>
## 功能实践项清单（执行时勾选）

下表为本步**全部功能/交付项**；执行者须逐项标注「实践状态」与「说明」，与设计文档、DNA 一致。

| 功能项 ID | 功能描述 | 对应设计/DNA | 实践状态 | 说明/代码位置 |
|-----------|----------|--------------|----------|----------------|
| F1 | `diting/classifier` 包与 SemanticClassifier 实现 | 09_ Module A、[设计要点](../../03_原子目标与规约/Stage3_模块实践/01_语义分类器_设计.md#design-stage3-01-points) | ✅ 已实现 | diting-core/diting/classifier/semantic.py |
| F2 | 输入：标的代码、申万行业、营收占比；输出：ClassifierOutput（Domain Tag 列表 + 置信度） | dna_module_a.input/output、ClassifierOutput.proto | ✅ 已实现 | classifier_pb2.py、SemanticClassifier.classify() |
| F3 | 分类规则 YAML：config/classifier_rules.yaml，规则不硬编码 | dna_module_a.classification_rules | ✅ 已实现 | config/classifier_rules.yaml、load_rules() |
| F4 | 从 L1/L2 或 MarketDataFeed 读取行业/营收（s0_data 准出后）；数据不可用时 Mock | [11_ 规约](../../03_原子目标与规约/_共享规约/11_数据采集与输入层规约.md)、设计文档 | ✅ 已实现 | _default_mock_provider()；可注入 industry_revenue_provider |
| F5 | 单测：分类规则、AGRI/TECH/GEO/UNKNOWN、边界、配置变更 | 四项 100% 之代码测试 100% | 待实现 | tests/ 或 diting/classifier/tests/ |
| F6 | Makefile：`make test` 覆盖 classifier，覆盖率 ≥ 约定 | DNA、02_验收标准 | 待实现 | diting-core/Makefile |
| F7 | Dockerfile：`diting-core/docker/module_a`，与 global_const.deployable_units.module_a.dockerfile_path 一致；镜像内可运行分类入口并执行 `make test` | [09_ 可部署单元](../../03_原子目标与规约/_共享规约/09_核心模块架构规约.md)、[global_const.deployable_units.module_a](../../03_原子目标与规约/_System_DNA/global_const.yaml) | 待实现 | diting-core/docker/module_a/ |
| F8 | 一键构建：Makefile 提供 `make build-module-a`（或 `make build-images` 含 module_a）；镜像名 diting-module-a，Tag 策略与 release_bundle 一致 | dna_dev_workflow.release_bundle、Stage2-02 V-BUILD-ALL 对齐 | 待实现 | diting-core/Makefile |
| F9 | 一键部署（可选）：diting-infra Chart `charts/module_a`、`make deploy-module-a` 或等价 Helm 命令；K3s 上可部署并运行 Module A | global_const.deployable_units.module_a.chart_path | 待实现 | diting-infra/charts/module_a、Makefile 或 CI |

**准出时** F1～F8 须均为「✅ 已实现」；F9 可选，按项目约定（若本阶段不做部署则标为「已占位」并说明）。

---

## 本步骤推荐 Context 清单（AI 执行时优先喂入）

| 文档/路径 | 用途 |
|-----------|------|
| `03_原子目标与规约/_共享规约/09_核心模块架构规约.md`（Module A 小节） | 输入输出与分类规则语义 |
| `03_原子目标与规约/_System_DNA/core_modules/dna_module_a.yaml` | 分类规则键与 purpose/input/output |
| `03_原子目标与规约/_Design_Artifacts/protocols/classifier/classifier_output.proto` 或 diting-core 内 `design/protocols/classifier/classifier_output.proto` | 输出契约 |
| `03_原子目标与规约/Stage3_模块实践/01_语义分类器_设计.md` | 设计要点与准出 |
| `03_原子目标与规约/_共享规约/11_数据采集与输入层规约.md` | 行业/营收数据来源与消费契约 |
| `03_原子目标与规约/_System_DNA/global_const.yaml`（deployable_units.module_a） | Dockerfile 路径、镜像名、Chart 路径 |
| `03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml`（release_bundle、module_to_stages.module_a） | 镜像 Tag 策略、一键构建/部署阶段约定 |

---

<a id="l4-stage3-01-four-100"></a>
## 四项 100% 与三层验证

### 四项 100%

| 维度 | 验收标准 | 验证方法 |
|------|----------|----------|
| **接口 100%** | 输出符合 ClassifierOutput.proto；可被 B/D 消费 | Proto 生成代码、接口契约单测 |
| **结构 100%** | 目录、配置路径与 DNA 一致 | 目录存在性、config 可加载 |
| **逻辑功能 100%** | 规则由 YAML 驱动；用真实或 Mock 数据跑通分类 | 配置变更验证、真实标的分类结果 |
| **代码测试 100%** | 单测覆盖分类规则、边界、UNKNOWN 路径 | `make test` 或 `pytest`，覆盖率 ≥ 约定 |

### 三层验证

| 层级 | 说明 |
|------|------|
| **单模块** | 用真实标的（如 000998.SZ、中芯国际、紫金矿业）或 Mock 验证分类结果 |
| **联动** | A 输出作为 B/D 输入，接口对接验证（可在 Stage3-02/04 中执行） |
| **全链路** | Module F 完成后参与 A→F 全链路验证（Stage3-05） |

---

<a id="l4-stage3-01-verify-checklist"></a>
<a id="l4-stage3-01-exit"></a>
## 验证项与结果清单（本步唯一测试结果填写处）

下表为本步**全部验证项**：命令、工作目录、期望结果与**结果填写**合一。执行顺序建议：先 1～3，再 4～5；每完成一项即在对应行填写「测试结果」与「实际输出或备注」。

| 验证项 ID | 验证内容 | 命令/方式 | 工作目录 | 期望结果 | 测试结果 | 实际输出或备注 |
|-----------|----------|-----------|----------|----------|----------|----------------|
| V-INT | 接口 100%：ClassifierOutput 契约满足、可被 B/D 消费 | Proto 编译；单测调用 classify 并断言输出结构 | diting-core | 退出码 0；输出字段与 Proto 一致 | 通过 | 默认本地单测；test_classifier_output_structure、test_domain_tag_enum_values 通过 |
| V-STRUCT | 结构 100%：diting/classifier、config/classifier_rules.yaml 存在 | `test -d diting/classifier`；`test -f config/classifier_rules.yaml`（或项目约定路径） | diting-core | 目录与配置文件存在；YAML 可加载 | 通过 | test_classifier_package_and_config_exist、test -d/test -f 通过 |
| V-LOGIC | 逻辑功能 100%：YAML 驱动 + 真实/Mock 数据验证 | 变更 YAML 后分类结果变化；至少 1 个真实或 Mock 标的跑通 | diting-core | 规则由配置驱动；分类结果符合预期 Tag | 通过 | Mock：000998→AGRI、688981→TECH、601899→GEO、999999→UNKNOWN；test_rules_driven_by_yaml 通过 |
| V-TEST | 代码测试 100%：单测全绿、覆盖率达标 | `make test` 或 `pytest diting/classifier -v --cov=diting.classifier` | diting-core | 退出码 0；覆盖率 ≥ 约定（如 80%） | 通过 | `pytest tests/unit/test_classifier.py -v` 12 passed；make test-classifier / test-classifier-cov |
| V-IMAGE | 镜像内可运行：构建后容器内执行 `make test` 或分类入口 | 构建 module_a 镜像后，容器内执行 `make test` 或 `python -m diting.classifier.run`（或等价） | — | 退出码 0；依赖与配置在镜像内完整 | 待填写 | |
| V-BUILD | 一键构建 Module A 镜像 | `make build-module-a`（或 `make build-images` 含 module_a） | diting-core | 退出码 0；镜像 diting-module-a 构建成功；可辅以 `docker images` | 待填写 | |
| V-DEPLOY | 一键部署（可选）：K3s 上部署 Module A | `make deploy-module-a` 或 Helm upgrade --install module-a（diting-infra）；或本地 Compose/单容器 run | diting-infra / diting-core | 服务可访问、分类接口可用 | 待填写 | 可选 |
| V-DOWNSTREAM | 联动（可选）：A 输出作为 B/D 输入 | 在 Stage3-02/04 中调用 A 输出并验证 | diting-core / 联动仓 | 接口对接无报错、Tag 传递正确 | 待填写 | Stage3-02/04 执行时补验 |

**准出**：① F1～F8 均为「✅ 已实现」（F9 可选）；② V-INT、V-STRUCT、V-LOGIC、V-TEST、V-IMAGE、V-BUILD 均为「通过」（V-DEPLOY 按项目约定）；③ **已更新 L5 [02_验收标准 对应行](../../05_成功标识与验证/02_验收标准.md#l5-stage-stage3_01)** 与 [l5-mod-A](../../05_成功标识与验证/02_验收标准.md#l5-mod-A)；④ 已更新 [02_战略追溯矩阵](../../06_追溯与审计/02_战略追溯矩阵.md) 可交付性备注（若适用）。

---

## 可执行验证命令汇总

以下命令均在 **diting-core** 根目录执行；与 DNA `verification_commands`、Makefile 对齐。

| 验证项 | 命令 | 期望 |
|--------|------|------|
| 单测与覆盖率 | `make test` 或 `pytest diting/classifier -v --cov=diting.classifier` | 退出码 0；覆盖率 ≥ 约定 |
| 结构 | `test -d diting/classifier && test -f config/classifier_rules.yaml` | 退出码 0 |
| 配置加载 | 单测或脚本加载 `config/classifier_rules.yaml` 并断言关键键存在 | 无异常、规则可被 classifier 使用 |
| 一键构建 | `make build-module-a`（或 `make build-images` 含 module_a） | 退出码 0；镜像 diting-module-a 存在 |
| 镜像内运行 | `docker run ... diting-module-a:tag make test` 或等价 | 退出码 0 |

---

<a id="l4-stage3-01-summary"></a>
## 本步实践总结（推荐执行顺序）

| 步骤 | 执行内容 | 预期结果 | 对应验证项 | 是否符合预期 |
|------|----------|----------|------------|----------------|
| 1 | 确认 Stage2-05 已准出或采用 Mock；核对 [本步依赖检查与数据来源](#l4-stage3-01-deps-check) | 数据来源清晰；Mock 或真实 L1/L2 可用 | — | ✅ 采用 Mock 验证 |
| 2 | 建立 diting/classifier 包、SemanticClassifier、ClassifierOutput 生成代码 | 接口符合 Proto；可被单测调用 | V-INT | ✅ |
| 3 | 新增 config/classifier_rules.yaml，实现 YAML 加载与规则匹配（AGRI/TECH/GEO/UNKNOWN） | 规则不硬编码；配置变更生效 | V-STRUCT、V-LOGIC | ✅ |
| 4 | 单测：分类规则、边界、UNKNOWN；Makefile 中 make test 覆盖 classifier | 单测全绿、覆盖率达标 | V-TEST | ✅ |
| 5 | 真实标的或 Mock 验证 1～2 个标的分类结果；可选联动 A→B/D | Tag 与预期一致；联动无报错 | V-LOGIC、V-DOWNSTREAM | ✅ Mock 通过；联动待 Stage3-02/04 |
| 6 | Dockerfile：diting-core/docker/module_a，镜像内可运行分类入口并执行 make test | 镜像构建成功；容器内 make test 退出码 0 | V-IMAGE | 待填写 |
| 7 | 一键构建：make build-module-a（或 make build-images 含 module_a）；镜像名与 Tag 策略与 DNA 一致 | 退出码 0；镜像 diting-module-a 可运行 | V-BUILD | 待填写 |
| 8 | 一键部署（可选）：diting-infra charts/module_a、make deploy-module-a 或等价 | 服务在 K3s 或本地可访问 | V-DEPLOY | 待填写 |
| 9 | 更新 L5 02_验收标准 stage3_01 行与 l5-mod-A；更新 02_战略追溯矩阵（若适用） | L5 与矩阵已同步 | 准出 | ✅ 已更新 L5 l5-mod-A |

---

## 本步骤准出（DoD）

- 代码已提交；单测全绿；F1～F8 均为「✅ 已实现」（F9 按项目约定）；V-INT、V-STRUCT、V-LOGIC、V-TEST、V-IMAGE、V-BUILD 均为「通过」。
- **单独运行**：Module A 可本地或镜像内单独运行（CLI/API 入口）；**Dockerfile** 在 diting-core/docker/module_a；**镜像与版本** 按 release_bundle（diting-module-a、tag 策略 git_sha_or_semver）；**一键构建** make build-module-a 可用；**一键部署**（可选）diting-infra Chart 与 make deploy-module-a 可用。
- **已更新 L5**：[02_验收标准 l5-stage-stage3_01](../../05_成功标识与验证/02_验收标准.md#l5-stage-stage3_01) 行与 [l5-mod-A](../../05_成功标识与验证/02_验收标准.md#l5-mod-A)；已更新 [02_战略追溯矩阵](../../06_追溯与审计/02_战略追溯矩阵.md) 可交付性备注（若适用）。

---

## 本步骤失败时

- **单测不通过** → 核对 09_ 分类规则与 ClassifierOutput.proto；检查 YAML 路径与键名。
- **真实数据不可用** → 先用 Mock 验证接口与结构，在文档与 L5 中标注「待 s0_data / Stage2-05 准出后补验真实标的」。
- **回退目标**：回退到 Stage2-05 准出状态；修复后重新执行本步验证。
- **重试**：建议重试上限 3 次；仍失败则按回退目标处理。
- **临时跳过**：须架构师或项目负责人审批；具体回退操作见 [03_ 工作流详细规划 八、失败与回退策略](../../03_原子目标与规约/开发与交付/03_项目全功能开发测试实践工作流详细规划.md)。
