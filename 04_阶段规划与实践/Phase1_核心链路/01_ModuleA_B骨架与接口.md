# Phase1 · 01 · Module A/B 骨架与接口

> [!NOTE] **[TRACEBACK] 战略追溯锚点**
> - **顶层概念**: [一句话定义与核心价值](../../01_顶层概念/01_一句话定义与核心价值.md)
> - **战略维度**: [01_产品设计维度](../../02_战略维度/产品设计/01_产品设计维度.md)
> - **原子能力**: [09_核心模块架构规约](../../03_原子目标与规约/09_核心模块架构规约.md)（Module A/B）、[01_需求与产品范围](../../03_原子目标与规约/产品设计/01_需求与产品范围.md)
> - **阶段**: [Phase1_核心链路](README.md)
> - **本步骤**: Module A/B 骨架与接口，满足「量化信号可产出」的接口契约

## 步骤目标

- **L3 阶段目标**：核心链路最小可跑通 — Module A 语义分类器、Module B 量化扫描引擎的目录、接口与最小实现（或占位），使「量化信号可产出」的接口契约成立，供 Module D 判官消费。
- **本步目标**：在代码仓中建立 Module A/B 的包/目录、对外接口定义与最小实现（或占位）；单测或占位通过。

## 关键产出物

1. Module A 分类器包/目录与对外接口定义（输入标的+可选行业，输出 Domain Tag + 置信度）
2. Module B 扫描引擎包/目录与对外接口定义（输入 Domain Tag/行情，输出 Quant 信号/候选池）
3. 至少一条占位或单测路径，满足「量化信号可产出」契约
4. 与 09_、01_ 一致的接口契约（A 输出可被 B/D 消费，B 输出可被 D 消费）

## 本步骤可开始条件（Definition of Ready）

1. [Stage0_骨架期](../00_交付流程步骤/Stage0_骨架期/README.md)（s0）已准出：核心接口存在、本地单测通过、目录与占位可运行。
2. 工作目录 **diting-core** 已就绪（三位一体仓库中代码仓可编译/可测）。
3. [09_核心模块架构规约](../../03_原子目标与规约/09_核心模块架构规约.md) 中 Module A/B 输入输出表已定稿可引用。

## 推荐模型（可选）

| 用途 | 推荐模型或档次 | 理由 |
|------|----------------|------|
| 代码生成/骨架 | Claude 3.5 Sonnet 或 Cursor 默认 | 规约与代码理解、接口与目录生成稳定 |
| 备选 | 由执行方自选 | 建议具备规约与代码理解能力 |

## 核心指令（The Prompt）

```
你是在 diting-core 代码仓中实现 Phase1 步骤 01 的开发者。请先阅读以下文档再动手：
- 必读：[09_核心模块架构规约](03_原子目标与规约/09_核心模块架构规约.md) 中 Module A/B 输入输出与接口约定；
- 必读：[01_需求与产品范围](03_原子目标与规约/产品设计/01_需求与产品范围.md) 第二节阶段目标与核心公式；
- 上下文：项目名 Diting，工作目录 diting-core，本步建立 Module A（语义分类器）与 Module B（量化扫描引擎）的骨架与接口。

你的任务：
1. 在 diting-core 下建立 Module A 包/目录（如 diting/classifier），定义对外接口：输入标的代码与可选申万行业/营收占比，输出 Domain Tag 列表与置信度；
2. 建立 Module B 包/目录（如 diting/scanner 或 strategy），定义对外接口：输入 Domain Tag/行情或占位数据，输出 Quant 信号结构（技术面得分、候选池）；
3. 实现最小逻辑或占位（硬编码/Mock），使「量化信号可产出」契约成立；
4. 为接口契约与至少一条路径编写单测或占位，确保 make test 或等价命令通过。

约束：接口与 09_ 输入输出表一致；Module B 输出可被 Module D 消费；代码注释含 [Ref: 03_09] 或 [Ref: 01_ModuleA_B]。

请输出：1. 变更/新增文件列表；2. 关键类型或接口定义（摘录）；3. 单测命令及通过结果摘要。
```

## Prompt 使用说明

将上述整段复制到 AI 或本地执行上下文；把「工作目录」替换为你的代码仓实际路径（如 `diting-core`）。执行后用「验收与测试」中的可复制命令自检，满足验收项与 DoD 再准出。

## 技术约束（DO / DON'T / 边界）

| 类型 | 内容 |
|------|------|
| **DO** | 接口与 09_ 输入输出表一致；Module A 输出可被 B/D 消费、Module B 输出可被 D 消费；单测或占位至少覆盖接口契约与一条路径；工作目录明确为 diting-core |
| **DON'T** | 不要实现与 09_ 不一致的字段或类型；不要跳过接口契约单测 |
| **边界** | 本步以骨架与接口为主，允许占位/Mock；若实现真实分类/扫描逻辑则建议走 5D（见逻辑密集说明） |

## 必读顺序

1. [09_核心模块架构规约](../../03_原子目标与规约/09_核心模块架构规约.md)（Module A/B 小节）
2. [01_需求与产品范围](../../03_原子目标与规约/产品设计/01_需求与产品范围.md)（第二节阶段目标、核心公式）
3. 本步骤「实施内容」与「验收标准」

## 依赖的 Stage

- 依赖 [Stage0_骨架期](../00_交付流程步骤/Stage0_骨架期/README.md)（stage_id: **s0**）准出：核心接口存在、本地单测通过、目录与占位可运行。

## 前置条件

- Stage0 骨架期已准出。
- 工作目录 **diting-core** 已就绪（三位一体仓库中代码仓）。

## 实施内容

**工作目录**：`diting-core`

1. **Module A（语义分类器）**
   - 建立分类器包/目录（如 `diting/classifier` 或项目约定路径）。
   - 定义对外接口：输入标的代码（及可选申万行业/营收占比），输出 Domain Tag 列表与置信度（见 09_ 输入/输出表）。
   - 实现最小逻辑或占位（如硬编码映射、Mock 返回），满足「可被下游调用」的契约。
   - 若有单测：覆盖接口契约与至少一条分类路径。

2. **Module B（量化扫描引擎）**
   - 建立扫描引擎包/目录（如 `diting/strategy` 或 `diting/scanner`）。
   - 定义对外接口：输入（可选 Domain Tag、行情数据或占位数据源），输出「量化信号」结构（如技术面得分、候选池列表），满足 09_ 中 Quant 输出约定。
   - 实现最小逻辑或占位（如单策略池占位、固定得分），满足「量化信号可产出」的接口契约。
   - 若有单测：覆盖接口契约与至少一条扫描路径。

3. **接口契约**
   - Module A 输出（Domain Tag + 置信度）可被 Module B 或 D 消费；Module B 输出（Quant 信号/候选）可被 Module D 消费；数据类型与 09_、01_核心公式与 MoE 规约一致。

## 验收与测试

本节即本步骤验收标准。

**验收检查项**

- [ ] Module A/B 目录与包结构存在，对外接口与 09_ 输入/输出一致。
- [ ] 单测或占位通过（见下方可复制命令）。
- [ ] 「量化信号可产出」：调用 Module B 接口可获得符合契约的 Quant 输出（可为占位数据）。

**可复制测试命令**（工作目录：`diting-core`）

```bash
cd diting-core
make test
# 或：go test ./... 等与项目 Makefile 一致
```

**成功标准**：退出码 0，无失败用例。**失败时**：先核对接口与 09_ 契约、占位数据；仍失败则见「本步骤失败时」。**与 DoD 分工**：上列为功能/产物验收；DoD 负责提交、单测全绿、Review、L5 更新。

## 本步骤准出（DoD）

- [ ] 代码已提交至约定分支/目录（工作目录 diting-core）
- [ ] Module A/B 目录与包存在，单测或占位通过（`make test` 或等价）
- [ ] Code Review 通过（或标注豁免）
- [ ] 已更新 L5 [02_验收标准](../../05_成功标识与验证/02_验收标准.md) 中**功能验收表**「09_ Module A/B」一行（状态与验证方式）；若该表无此行则按 L5 约定新增或标注 N/A

## 输出格式 / 期望交付形态

1. 变更/新增文件列表（路径 + 简要说明）
2. 关键类型或接口定义摘录（Module A 输入输出、Module B 输入输出）
3. 单测命令及通过结果摘要（如 `make test` 通过）

## 下一步

完成本步且通过验收、DoD 全勾后，进入 [02_ModuleD判官最小闭环](02_ModuleD判官最小闭环.md)。**重要**：02_ 依赖本步 Quant 信号接口可调用，骨架/接口未就绪勿进入 02_。

## 产出物

| 产出 | 说明 |
|------|------|
| `classifier/` 或等价包 | Module A 语义分类器目录与接口 |
| `scanner/` 或 `strategy/` 等价包 | Module B 量化扫描引擎目录与接口 |
| 接口定义与至少一条占位/单测路径 | 满足「量化信号可产出」契约 |

## 本步骤失败时

- **单测或占位不通过**：检查接口与 09_ 契约是否一致，修正实现或占位数据后再跑。
- **下游 02_ 无法消费**：确认 Module B 输出结构（Quant 信号）与 09_、01_ 一致，字段与类型可被 D 判官消费。
- **依赖未就绪**：确认 Stage0 骨架期已准出（目录、构建、单测环境可用）；否则先完成 s0。

回退与失败分级见 [03_项目全功能开发测试实践工作流详细规划 八、失败与回退策略](../../03_原子目标与规约/开发与交付/03_项目全功能开发测试实践工作流详细规划.md)。

## Phase–Stage 接口

- **本步准出即 Stage s1 准出条件之一**；本步验收命令纳入 [Stage1_逻辑填充期 01_](../00_交付流程步骤/Stage1_逻辑填充期/01_本阶段实践与验证.md) 可执行验证清单。
- **本步产出**：供 [02_ModuleD判官最小闭环](02_ModuleD判官最小闭环.md) 与 Stage1 01_ 使用；02_ 依赖本步 Quant 信号接口可调用。
- **本步依赖**：依赖 [Stage0_骨架期](../00_交付流程步骤/Stage0_骨架期/README.md)（s0）准出 = 核心接口存在、本地单测通过、目录与占位可运行。

## 路径与命名（可选）

- **代码路径**：`diting-core/diting/classifier/`（Module A）、`diting-core/diting/scanner/` 或 `strategy/`（Module B）；以项目 [02_三位一体仓库规约](../../03_原子目标与规约/02_三位一体仓库规约.md) 为准。
- **业务词 → 英文**：分类器 → Classifier；扫描引擎 → Scanner；Domain Tag 枚举见 09_（如 BULLISH/BEARISH、行业/主题 Tag 英文枚举）。

## 本步骤涉及的 DNA 键

| DNA 键 | 用途 |
|--------|------|
| `product_scope.phases` Phase1-xxx | 本 Phase 范围 |
| `core_modules.module_a` / `core_modules.module_b`（若 DNA 中存在） | 模块配置与接口约定 |
| `dna_dev_workflow.workflow_stages[s1].delivery_scope` | 交付范围含 Module A/B 骨架 |

## 逻辑密集说明与人/AI 角色

本步骤以骨架与接口为主，非公式/算法密集；**不强制 5D**。若实现真实分类/扫描逻辑则建议按 5D 与 Table-Driven Tests 锚定（见 [03_项目全功能开发测试实践工作流详细规划](../../03_原子目标与规约/开发与交付/03_项目全功能开发测试实践工作流详细规划.md)）。代码注释可标注 `[Ref: 01_ModuleA_B骨架与接口]` 或 `[Ref: 03_09]`。

**人/AI 角色**：人类定义接口与契约（与 09_ 对齐）；AI 补全目录、占位实现与单测。Defense 由人类执行（Review、L5 更新）。
