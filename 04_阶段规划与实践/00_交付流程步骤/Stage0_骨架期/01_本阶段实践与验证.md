# Stage0 骨架期 · 本阶段实践与验证

> [!NOTE] **[TRACEBACK] 步骤锚点**
> - **战略维度**: [01_开发与交付流程维度](../../../02_战略维度/开发与交付/01_开发与交付流程维度.md)
> - **原子规约**: [01_开发生命周期与实践流程规约](../../../03_原子目标与规约/开发与交付/01_开发生命周期与实践流程规约.md) **阶段 0**
> - **本步骤对应 01 规约**: 阶段 0（本地骨架期）
> - **DNA stage_id**: `s0`（[dna_dev_workflow.yaml](../../../03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml)）

---

## 本步骤落实的 _System_DNA 键

| DNA 键 | 用途 |
|--------|------|
| `dna_dev_workflow.workflow_stages[s0]` | delivery_scope、exit_criteria、test_focus、work_dir、verification_commands、l5_stage_anchor |
| `dna_dev_workflow.workflow_stages[s0].delivery_scope` | 交付范围：核心接口、目录与占位实现 |
| `dna_dev_workflow.workflow_stages[s0].exit_criteria` | 准出条件：核心接口存在且本地单测通过；目录与占位实现可运行 |
| `dna_dev_workflow.workflow_stages[s0].work_dir` | 工作目录权威：type=repo_i，diting-core 代码仓 |
| `dna_dev_workflow.workflow_stages[s0].verification_commands` | 可执行验证命令：make test，expected_exit 0；expected_outcome/failure_hint 见 DNA |
| `dna_dev_workflow.workflow_stages[s0].l5_stage_anchor` | 准出时更新 L5 的行锚：l5-stage-s0 |
| `dna_dev_workflow.workflow_stages[s0].test_focus` | 验证重点：unit |
| `global_const.trinity_repos.repo_i.directories` | 须建立的目录列表（diting/abstraction/、diting/drivers/、diting/moe/、diting/risk/、diting/strategy/、tests/、design/） |
| `global_const.trinity_repos.repo_i.make_targets` | 验收命令来源（如 test） |
| `global_const.trinity_repos.design_and_adr.design_location` | 设计产物位置（diting-core/design/） |

实施内容与验证步骤按以上键展开；目录列表从 DNA 来，验收命令与代码仓 Makefile 一致。

## 本步骤产出物与下一阶段消耗

- **本步骤产出物**（DNA artifacts）：核心接口与占位实现、本地单测通过。
- **下一阶段消耗**（s1 准入）：Stage s0 准出。

### 5D 角色与执行者

| 项目 | 说明 |
|------|------|
| **5D 角色** | Design、Drive（接口与占位设计；Table-Driven Tests 先红灯再绿） |
| **执行者** | AI 起草目录与占位；Human 做 Defense（Code Review、勾选准出、更新 L5） |

### 本步骤推荐 Context 清单 <a id="context-清单"></a>

<a id="context-必读-yaml"></a>必读 YAML 与 L3 路径（DNA 为权威）：[dna_dev_workflow.yaml](../../../03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml) 中 `workflow_stages[s0]`、[global_const.yaml](../../../03_原子目标与规约/_System_DNA/global_const.yaml) 中 `trinity_repos.repo_i`。

| 类型 | 路径或文档 |
|------|-------------|
| 必读 YAML | `dna_dev_workflow.workflow_stages[s0]`、`global_const.trinity_repos.repo_i` |
| 必读 L3 | [01_开发生命周期与实践流程规约](../../../03_原子目标与规约/开发与交付/01_开发生命周期与实践流程规约.md)、[03_项目全功能开发测试实践工作流详细规划](../../../03_原子目标与规约/开发与交付/03_项目全功能开发测试实践工作流详细规划.md) |
| 可选 | 02_三位一体、09_核心模块（接口约定） |
| 建议量级 | 单步 Context 建议不超过约 50k 字符（见协议 §8.5） |

### 本步骤精密 Prompt 要素

- **Context**：上述必读 YAML 与 L3；禁止明文密钥。
- **Task**：按 delivery_scope 与 exit_criteria 建立核心接口、目录与占位实现，本地单测通过。
- **Constraint**：工作目录 diting-core；逻辑密集处须先 Drive（测试）再 Decompose（实现）。
- **Output Format**：核心接口存在、占位可运行、单测全绿；产出物见上。

## 核心指令（The Prompt）

```
你是在 diting-core 代码仓中执行 Stage0（骨架期）的开发者。请先阅读以下内容再动手：
- 必读：dna_dev_workflow.workflow_stages[s0]、global_const.trinity_repos.repo_i（见 03_原子目标与规约/_System_DNA/）；
- 必读：01_开发生命周期与实践流程规约、03_项目全功能开发测试实践工作流详细规划；
- 可选：02_三位一体、09_核心模块（接口约定）。
- 禁止在 Prompt 或 01_ 中写明文密钥。

你的任务：
1. 按 repo_i.directories 在 diting-core 下建立目录：diting/abstraction/、diting/drivers/、diting/moe/、diting/risk/、diting/strategy/、tests/、design/（与 02_三位一体、09_核心模块一致；不实现业务逻辑）。
2. 定义核心接口（Protocol/抽象类），与 04_全链路通信协议矩阵、05_接口抽象层规约对齐。
3. 为关键接口编写占位实现或 Mock，使「导入 + 最小调用」可运行。
4. 编写 Table-Driven Tests（与 03_架构设计共识一致），占位与单测使 make test 可运行；接口与协议对齐引用 04_/05_ 规约或对应 DNA。

约束：工作目录 diting-core；逻辑密集处须先 Drive（测试）再 Decompose（实现）。
请输出：变更/新增文件列表、关键接口摘录、make test 执行结果（退出码 0、单测全绿）。
```

## Prompt 使用说明

将上述整段复制到 AI 或本地执行上下文；工作目录替换为你的 diting-core 实际路径。执行后用下方「验证与准出」中的命令自检，满足准出检查清单再准出。

---

## 交付范围（直引 DNA）

**最小交付范围**（来自 `dna_dev_workflow.workflow_stages[s0].delivery_scope`）：**核心接口、目录与占位实现**。具体任务拆分见各 Phase 步骤（若已创建）。

---

## 验证与准出 <a id="验证与准出"></a>

工作目录：**diting-core** 根目录。与 DNA `workflow_stages[s0].verification_commands` 及代码仓 Makefile/CI 一致（代码仓变更须同步本文档，§十一）。

| 命令/检查 | 工作目录 | 期望结果 | 失败时 |
|-----------|----------|----------|--------|
| 目录与接口存在 | diting-core | 目录与 repo_i.directories 一致；核心接口已定义 | 按 DNA 与 09_ 补建 |
| `make test` | diting-core 根目录 | 退出码 0；单测全绿 | 运行单测定位失败用例，见「本步骤失败时」 |

闭环点：接口导入+占位可调用、目录与占位可运行（[03_工作流详细规划](../../../03_原子目标与规约/开发与交付/03_项目全功能开发测试实践工作流详细规划.md) 第六节）。

**准出检查清单**（与 01 规约阶段 0 准出条件逐条对应；全部勾选后准出）：

- [ ] 核心接口存在且本地单测通过
- [ ] 目录与占位实现可运行
- [ ] 无具体业务逻辑实现（逻辑归属阶段 1 及 Phase 功能步骤）
- [ ] **已更新 L5 [02_验收标准](../../../05_成功标识与验证/02_验收标准.md) 中本 stage（s0）对应行（状态+验证方式）**

验收完成后再进入 Stage1。

---

## 验证结果与 L5 同步

准出时须更新 **L5 [02_验收标准](../../../05_成功标识与验证/02_验收标准.md) 中 workflow_stages 映射表 s0 行**（将对应行状态更新为已通过并注明验证方式）。本目录不保留可填写的验证结果表，直接更新 L5。

---

## 本步骤失败时

- **回退**：回退到本阶段第一步（重新建立目录与占位、补齐单测）。
- **重试上限**：建议 3 次；若仍不通过则回退到上一阶段最后一步（若有）或暂停待人工排查。
- **临时跳过某验证项**：不允许；准出条件须全部满足。若需调整准出条件，须经架构师或项目负责人审批并更新 L3/ DNA 与本文档。
- **验证失败时**：除回退/重试外，须输出**失败项**（未通过的命令/检查点）及**建议修正动作**（如 make test 失败 → 运行单测或等价命令定位失败用例）；若由 CI 执行，须将失败与 01_ 对应步骤链接。自动反馈修正分级见 [03_项目全功能开发测试实践工作流详细规划 八、失败与回退策略](../../../03_原子目标与规约/开发与交付/03_项目全功能开发测试实践工作流详细规划.md#八失败与回退策略)。
- 具体回退操作与检查点定义见 [03_项目全功能开发测试实践工作流详细规划 八、失败与回退策略](../../../03_原子目标与规约/开发与交付/03_项目全功能开发测试实践工作流详细规划.md#八失败与回退策略)。
