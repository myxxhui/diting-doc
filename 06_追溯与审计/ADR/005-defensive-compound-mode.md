# ADR-005: 引入防御性复利模式

## 状态
Accepted

## Context (背景)

当年化收益达到 30% 时，需要保护利润，防止回吐。

**问题**：
- 年化收益达到 30% 后，继续激进策略可能导致回吐
- 需要平衡"复利增长"和"生存底线"
- 防止"大起大落"（触发利润锁定线）

## Decision (决策)

引入 **防御性复利模式**：

1. **触发条件**：年化收益 ≥ 30%

2. **防御动作**：
   - **胜率阈值提高**：从 80% 提至 90%（更严格筛选）
   - **仓位减半**：降低风险暴露（从 15% 降至 7.5%）
   - **锁定利润垫**：锁定 25% 的利润，防止回吐

3. **退出条件**：年化收益降至 25% 以下（恢复正常模式）

## Consequences (后果)

**[+] 正面影响**：
- 保护利润，防止回吐
- 降低风险暴露（仓位减半）
- 支持"生存底线"要求（回撤 < 12%）
- 支持稳定收益增长（避免"大起大落"）

**[-] 负面影响**：
- 可能降低收益增长速度（胜率阈值提高，仓位减半）
- 可能错过一些交易机会（更严格的筛选）

**[!] 风险与注意事项**：
- 触发阈值设置（30% vs 30.1%）需要精确
- 退出条件需要明确（避免频繁切换）
- 需要监控防御模式的触发频率

## Alternatives Considered (考虑的替代方案)

1. **继续激进策略**：
   - 优点：收益增长快
   - 缺点：风险大，可能回吐利润
   - 结论：❌ 不采用

2. **完全停止交易**：
   - 优点：完全安全
   - 缺点：无法增长，无法满足"复利增长"要求
   - 结论：❌ 不采用

3. **防御性复利模式**：
   - 优点：平衡收益和风险
   - 缺点：收益增长速度可能降低
   - 结论：✅ **采用**

## Compliance Check (合规检查)

- ✅ 符合"生存底线"要求（回撤 < 12%）
- ✅ 符合"复利增长"要求（稳定收益，避免回吐）
- ✅ 符合"认知边界"要求（胜率阈值提高，更严格筛选）

## Traceability (追溯性)

- **L1 价值点**: [核心价值：不可能三角](../01_顶层概念/01_一句话定义与核心价值.md)
- **L2 维度**: [技术栈与架构维度](../02_战略维度/产品设计/02_技术栈与架构维度.md)
- **L3 规约**: [核心模块架构规约](../03_原子目标与规约/_共享规约/09_核心模块架构规约.md)
- **L5 验收**: [成功标识详细规约](../05_成功标识与验证/03_成功标识详细规约.md)
- **相关 ADR**：ADR-002

## Implementation Notes (实施说明)

### 判官模块实现

```python
# diting-core/diting/gavel/defensive_mode.py
class DefensiveMode:
    def check_defensive_mode(self, current_annual_return: float) -> bool:
        """检查是否触发防御性复利模式"""
        return current_annual_return >= 0.30
    
    def apply_defensive_rules(self, verdict: Verdict) -> Verdict:
        """应用防御性规则"""
        # 1. 胜率阈值从 80% 提至 90%
        if verdict.win_rate_prediction < 0.9:
            verdict.action = Action.ACTION_PASS
        
        # 2. 仓位减半
        verdict.suggested_position_ratio *= 0.5
        
        # 3. 标记防御模式
        verdict.is_defensive_mode = True
        
        return verdict
```

### 验收标准

- 连续 6 个月未触及利润锁定线
- 防御模式触发后，回撤 < 12%
- 防御模式触发后，年化收益稳定在 25%-35% 之间

## Review History (审查历史)

- 2026-02-11: 初始创建
- 2026-02-11: 状态变更（Accepted）
