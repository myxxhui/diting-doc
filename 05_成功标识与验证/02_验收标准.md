# L5 · 验收标准

> [!NOTE] **[TRACEBACK] 成功验证锚点**
> - **顶层概念**: [一句话定义与核心价值](../01_顶层概念/01_一句话定义与核心价值.md)
> - **原子规约**: [原子规约目录](../03_原子目标与规约/)
> - **阶段实践**: [阶段规划与实践目录](../04_阶段规划与实践/)
> - **本文档**: L5 层级，定义验收标准与验证方法

## 验收原则

每条验收标准必须：
1. **可测量**：有明确的量化指标或判定条件
2. **可追溯**：能追溯到对应的 L3 规约与 L1 价值点
3. **可验证**：有明确的验证方法与工具

### L5 验收随 L4 阶段逐步填充

**说明**：L5 验收**随 L4 阶段逐步填充**——每完成一个 [workflow_stages](../03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml) 阶段，更新本目录下对应验收项与验证方法。L4 步骤文档可引用「本步骤完成后，在 L5 的 XX 表填写 YY 验收」。早期阶段（Stage1～2）以**工程准出**为主（如单测通过、make build 通过）；业务指标验收在 Stage3/4 功能就绪后填入上表。

**验证结果与 L5 同步约定**：每个阶段**准出时须同步更新 L5**，避免 L4 填了、L5 未更新。具体约定：
- **同步目标**：本小节下表「DNA stage_id ↔ 阶段名称 ↔ 本阶段对应 L5 验收」中，该 stage 对应的一行；以及（若适用）下方「功能验收」「不可能三角验收」「工程性能验收」「质量验收」表中与本阶段相关的行。
- **执行方**：阶段目录内「验证结果记录」文档执行者或 AI 在勾选准出检查清单后，须在本文档（02_验收标准）中更新上表该行状态（如 ⏳→✅），并注明验证方式或链接。
- **引用**：各阶段目录内「验证结果记录」或准出检查清单须注明：「准出时须同步至：L5 [02_验收标准.md](02_验收标准.md) 中 workflow_stages 映射表对应行」。
- **与 DNA 强一致**：本表 workflow_stages 行集必须与 [dna_dev_workflow.yaml](../03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml) 的 `workflow_stages` 的 `stage_id` 一一对应；DNA 增删 stage 时须同步增删本表对应行。

**与 DNA 的约定**：下表表体（阶段名称、本阶段对应 L5 验收说明、消耗/产出）与 [dna_dev_workflow.yaml](../03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml) 的 `workflow_stages` 强一致；可由脚本从 DNA 生成或做一致性校验。本表不设「状态」列，准出时由执行方在 06_ 追溯矩阵或阶段目录内勾选准出检查清单并注明验证方式；L5 文档仅保留本表结构及锚点，与 DNA 同步的静态内容以 DNA 为源。**可部署单元与热路径**：热路径 D+E+F（stage3_04～06）准出时按可部署单元「热路径」整体验收（同一镜像、部署、连调）；**开发期连调**验收见各 Stage README「开发期连调」与 [03_ 工作流详细规划](../03_原子目标与规约/开发与交付/03_项目全功能开发测试实践工作流详细规划.md)。

下表「消耗/产出」与 DNA 一致，便于审计。每行锚点供 DNA `l5_stage_anchor` 与准出同步引用。

**锚点索引**：本页 workflow_stages 表每行使用显式锚点 `l5-stage-{stage_id}`（如 `l5-stage-stage1_01`），与协议 §5.4 约定一致；L4 准出时引用本表对应行锚点。可选步骤保留行与锚点的约定与 DNA 一致，DNA 增删 stage 时须同步本表行与锚点。

| 锚点 | DNA stage_id | 阶段名称 | 本阶段对应 L5 验收（或说明） | 消耗/产出（依赖与产出） |
|------|--------------|----------|------------------------------|--------------------------|
| <a id="l5-stage-stage1_01"></a>l5-stage-stage1_01 | stage1_01 | 三位一体仓库初始化 | 工程：三仓目录符合 02_三位一体；diting-core make test 占位通过 | 消耗：L3 规约与 DNA 定稿；产出：diting-core、diting-infra 目录 |
| <a id="l5-stage-stage1_02"></a>l5-stage-stage1_02 | stage1_02 | 核心接口与Proto占位 | 工程：核心接口存在、本地单测通过 | 消耗：Stage1-01 准出；产出：核心接口与占位、单测通过 |
| <a id="l5-stage-stage1_03"></a>l5-stage-stage1_03 | stage1_03 | 基础设施 ECS 与 K3s 就绪 | 工程：deploy-engine Up 成功、KubeConfig 可用、验证后回收 | 消耗：Stage1-02 准出；产出：K3s 集群可用（验证后已回收） |
| <a id="l5-stage-stage1_04"></a>l5-stage-stage1_04 | stage1_04 | 密钥与配置模板就绪 | 工程：Sealed-Secrets 模板、config 模板可用 | 消耗：Stage1-03 准出；产出：Sealed-Secrets 模板、config 模板 |
| <a id="l5-stage-stage2_01"></a>l5-stage-stage2_01 | stage2_01 | 基础设施与依赖部署 | 工程：TimescaleDB/Redis/PostgreSQL 可用；Schema init Job 成功 | 消耗：Stage1-04 准出；产出：基础组件 Chart、Schema init |
| <a id="l5-stage-stage2_02"></a>l5-stage-stage2_02 | stage2_02 | 采集逻辑与Dockerfile | 工程：采集逻辑实现；make ingest-test 可运行 | 消耗：Stage2-01 准出；产出：采集任务、Dockerfile |
| <a id="l5-stage-stage2_03"></a>l5-stage-stage2_03 | stage2_03 | 本地测试与K3s连调 | 工程：本地采集可写 L1；MarketDataFeed 可读取 | 消耗：Stage2-02 准出；产出：连调路径跑通 |
| <a id="l5-stage-stage2_04"></a>l5-stage-stage2_04 | stage2_04 | 镜像打包与ACR推送 | 工程：make build 成功；镜像可推送 | 消耗：Stage2-03 准出；产出：镜像可推送 |
| <a id="l5-stage-stage2_05"></a>l5-stage-stage2_05 | stage2_05 | 采集模块部署与验收 | 工程：采集模块部署；make ingest-test 通过；Stage2 准出 | 消耗：Stage2-04 准出；产出：采集模块部署成功 |
| <a id="l5-stage-stage3_01"></a>l5-stage-stage3_01 | stage3_01 | Module A 语义分类器 | 功能：同 l5-mod-A；四项 100% | 消耗：Stage2-05 准出；产出：Module A 实现 |
| <a id="l5-stage-stage3_02"></a>l5-stage-stage3_02 | stage3_02 | Module B 量化扫描引擎 | 功能：同 l5-mod-B；四项 100% | 消耗：Stage3-01 准出；产出：Module B 实现 |
| <a id="l5-stage-stage3_03"></a>l5-stage-stage3_03 | stage3_03 | Module C MoE 议会 | 功能：同 l5-mod-C；四项 100% | 消耗：Stage3-02 准出；产出：Module C 实现 |
| <a id="l5-stage-stage3_04"></a>l5-stage-stage3_04 | stage3_04 | Module D 判官 | 功能：同 l5-mod-D；四项 100% | 消耗：Stage3-03 准出；产出：Module D 实现 |
| <a id="l5-stage-stage3_05"></a>l5-stage-stage3_05 | stage3_05 | Module E 风控盾 | 功能：同 l5-mod-E；四项 100% | 消耗：Stage3-04 准出；产出：Module E 实现 |
| <a id="l5-stage-stage3_06"></a>l5-stage-stage3_06 | stage3_06 | Module F 执行网关 | 功能：同 l5-mod-F；四项 100%；全链路 A→F | 消耗：Stage3-05 准出；产出：Module F 实现 |
| <a id="l5-stage-stage3_07"></a>l5-stage-stage3_07 | stage3_07 | 全链路验证 | 工程：A→F 全链路可跑通；make test 通过；Stage3 准出 | 消耗：Stage3-06 准出；产出：全链路验证通过 |
| <a id="l5-stage-stage4_01"></a>l5-stage-stage4_01 | stage4_01 | Module C MoE 议会接入 | 功能：同 l5-func-05；Router 与 D 对接 | 消耗：Stage3-07 准出；产出：MoE 议会接入 |
| <a id="l5-stage-stage4_02"></a>l5-stage-stage4_02 | stage4_02 | Module F 执行网关接入 | 功能：同 l5-func-06；E→F 衔接 | 消耗：Stage4-01 准出；产出：执行网关接入 |
| <a id="l5-stage-stage4_03"></a>l5-stage-stage4_03 | stage4_03 | 回测或仿真验证 | 功能：同 l5-func-07；Stage4 准出 | 消耗：Stage4-02 准出；产出：回测/仿真验证、Stage4 准出 |
| <a id="l5-stage-stage5_01"></a>l5-stage-stage5_01 | stage5_01 | 可观测性与日志指标 | 功能：同 l5-func-08；日志/指标/健康检查满足 L3 | 消耗：Stage4-03 准出；产出：可观测性就绪 |
| <a id="l5-stage-stage5_02"></a>l5-stage-stage5_02 | stage5_02 | 成本治理与Token熔断 | 功能：同 l5-func-09；Token 预算与熔断可生效 | 消耗：Stage5-01 准出；产出：成本治理 |
| <a id="l5-stage-stage5_03"></a>l5-stage-stage5_03 | stage5_03 | 多策略池或配置扩展 | 按 09 规约与 L1 价值查漏补缺 | 消耗：Stage5-02 准出；产出：多策略扩展 |
| <a id="l5-stage-stage5_04"></a>l5-stage-stage5_04 | stage5_04 | Level1 入口与 L5 验收对齐 | 功能：同 l5-func-10；Stage5 准出 | 消耗：Stage5-03 准出；产出：Level 1 入口满足、Stage5 准出 |

**锚点与 DNA 的对应关系**：上表每行锚点 `l5-stage-stageX_0Y` 与 dna_dev_workflow 的 `stage_id` 一一对应。DNA 中 Stage3/4/5 的 `l5_stage_anchor` 仍为 l5-mod-A～F、l5-func-05～10 等，与「功能验收」表一致；准出时步骤 DoD 可更新功能验收表（l5-mod-* / l5-func-*）或本表该行，二者验收语义一致。

## 验收标准分类

### 功能验收

**与 DNA 的约定**：下表每行（锚点、能力规约、Phase/步骤、验收标准、验证方法）与 [global_const.yaml](../03_原子目标与规约/_System_DNA/global_const.yaml) 的 `product_scope.phases[].steps`（含 `l5_anchor`、`l5_acceptance_criterion`、`verification_method`）一致；可由脚本从 DNA 生成表体或做一致性校验。新增 Phase 步骤时只改 DNA 再生成/校验。**状态**列由对应 Phase 步骤 DoD 完成时更新。

以下按 Phase/步骤可追溯至 [01_需求与产品范围](../03_原子目标与规约/产品设计/01_需求与产品范围.md) 第四节 L1 价值点与 [09_核心模块架构规约](../03_原子目标与规约/_共享规约/09_核心模块架构规约.md)。**状态更新约定**：下表各行状态由对应 Phase 步骤**本步骤准出（DoD）**完成时更新；各步骤文档的 DoD 须引用**锚点**或「能力规约」列（如「已更新 L5 02_ 功能验收表 锚点 `l5-func-02`」或「…表中『09_ Module D』行」），执行准出时同步勾选并更新本表该行状态（⏳→✅）及验证方式。

| 锚点 | 能力规约 | Phase/步骤 | 验收标准 | 验证方法 | 状态 |
|------|---------|------------|---------|---------|------|
| `l5-func-00` | 11_ 数据采集与输入层 | [Stage2_数据采集与存储](../04_阶段规划与实践/Stage2_数据采集与存储/) 02_～05_ | 真实数据可写入 L1/L2 且可被 Module A/B/C 消费 | make ingest-test 或 DNA 约定命令；由 Stage2-05 准出时更新 | ⏳ |
| `l5-func-01` | 09_ Module A/B | [Stage3_模块实践](../04_阶段规划与实践/Stage3_模块实践/) 01_～02_ | Module A/B 目录与接口存在，量化信号可产出 | 单测或占位通过、接口契约满足 | ⏳ |
| <a id="l5-mod-A"></a>`l5-mod-A` | 09_ Module A | [Stage3_模块实践](../04_阶段规划与实践/Stage3_模块实践/) 01_ | 四项 100% | 单模块+联动+全链路 | ⏳ |
| <a id="l5-mod-B"></a>`l5-mod-B` | 09_ Module B | Stage3_模块实践 02_ | 同上 | 同上 | ⏳ |
| <a id="l5-mod-C"></a>`l5-mod-C` | 09_ Module C | Stage3_模块实践 03_ | 同上 | 同上 | ⏳ |
| <a id="l5-mod-D"></a>`l5-mod-D` | 09_ Module D | Stage3_模块实践 04_ | 同上 | 同上 | ⏳ |
| <a id="l5-mod-E"></a>`l5-mod-E` | 09_ Module E | Stage3_模块实践 05_ | 同上 | 同上 | ⏳ |
| <a id="l5-mod-F"></a>`l5-mod-F` | 09_ Module F | Stage3_模块实践 06_ | 同上；全链路 A→F | 同上 | ⏳ |
| `l5-func-02` | 09_ Module D | Stage3 04_ | 判官投票+Kelly+Alpha 与 01_核心公式一致 | Table-Driven 单测、边界覆盖 | ⏳ |
| `l5-func-03` | 09_ Module E | Stage3 05_ | 风控接口与占位（硬止损 2%、盈亏比≥1.5） | 单测或集成路径验证 | ⏳ |
| `l5-func-04` | 09_ A→E 集成 | Stage3 07_ | A→B→D→E 最小路径可跑通 | 集成测试或主路径执行 | ⏳ |
| `l5-func-05` | 09_ Module C | [Stage4_MoE与执行网关](../04_阶段规划与实践/Stage4_MoE与执行网关/) 01_ | Router 按 Tag 分发，专家意见与 D 对接 | 单测/集成、Alpha 链路可执行 | ⏳ |
| `l5-func-06` | 09_ Module F、05_接口抽象层 | Stage4 02_ | Broker 抽象与占位/仿真实现，E→F 衔接 | 单测或 place_order 调用验证 | ⏳ |
| `l5-func-07` | 研产同构 | Stage4 03_ | Docker/K3s 下回测或仿真路径跑通 | 回测/仿真任务成功 | ⏳ |
| `l5-func-08` | 08_心跳与健康检查、observability | [Stage5_优化与扩展](../04_阶段规划与实践/Stage5_优化与扩展/) 01_ | 日志/指标/健康检查满足 L3 | Prometheus 与健康端点验证 | ⏳ |
| `l5-func-09` | cost_governance | Stage5 02_ | Token 预算与熔断逻辑可生效 | 配置读取与熔断路径验证 | ⏳ |
| `l5-func-10` | Level 1 入口、L5 表 | Stage5 04_ | 满足三级流水线 Level 1、功能/不可能三角可追溯 | 入口条件核对、L5 表补齐 | ⏳ |

### 不可能三角验收（核心业务指标）

| 维度 | 指标 | 目标值 | 验证方法 | 状态 |
|------|------|--------|---------|------|
| **认知边界 (Certainty)** | 胜率（WinRate） | ≥ 75% | 回测统计（双重验证后目标 ≥ 80%） | ⏳ |
| **认知边界 (Certainty)** | 可解释标的占比 | ≥ 10% | 统计可解释逻辑的交易信号占比 | ⏳ |
| **复利增长 (Growth)** | 年化收益率（CAGR） | ≥ 30% | 回测与实盘统计 | ⏳ |
| **复利增长 (Growth)** | 现金拖累监控 | 空仓 > 5 天触发 | 监控系统日志 | ⏳ |
| **生存底线 (Survival)** | 最大回撤（MaxDD） | < 12% | 回测与实盘监控 | ⏳ |
| **生存底线 (Survival)** | 单笔风险 | < 2% | 风控模块日志 | ⏳ |
| **生存底线 (Survival)** | 盈亏比 | > 1.5 | 风控模块日志 | ⏳ |
| **生存底线 (Survival)** | Risk Shield 拦截率 | 100% | 高波动模拟测试 | ⏳ |

### 工程性能验收

| 指标 | 目标值 | 验证方法 | 状态 |
|------|--------|---------|------|
| 全市场扫描+推理耗时 | < 30 分钟 | 系统监控 | ⏳ |
| RTO（恢复时间目标） | < 5 分钟 | 故障演练 | ⏳ |
| API 响应时间 P95 | < 500ms | 压测工具 | ⏳ |
| API 响应时间 P99 | < 1000ms | 压测工具 | ⏳ |
| 可用性 | ≥ 99.9% | 监控系统 | ⏳ |

### 质量验收

| 指标 | 目标值 | 验证方法 | 状态 |
|------|--------|---------|------|
| 代码覆盖率 | ≥ 80% | 测试工具 | ⏳ |
| 静态分析 | 0 高危漏洞 | SonarQube | ⏳ |
| 核心公式实现 | Alpha = (Quant_Signal ∩ Router(Experts)) × Kelly_Position | 代码审查 | ⏳ |
| MoE 架构实现 | Router 动态选择专家 | 代码审查 + 测试 | ⏳ |

## 详细验收标准

→ 参见：
- [03_成功标识详细规约.md](./03_成功标识详细规约.md)（详细的技术规约）
- [04_验收标准通俗解释.md](./04_验收标准通俗解释.md)（通俗易懂的解释）

## 下一步

→ 参见 [06_追溯与审计/](../06_追溯与审计/) 目录下的追溯与审计文档
