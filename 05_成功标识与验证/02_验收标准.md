# L5 · 验收标准

> [!NOTE] **[TRACEBACK] 成功验证锚点**
> - **顶层概念**: [一句话定义与核心价值](../01_顶层概念/01_一句话定义与核心价值.md)
> - **原子规约**: [原子规约目录](../03_原子目标与规约/)
> - **阶段实践**: [阶段规划与实践目录](../04_阶段规划与实践/)
> - **本文档**: L5 层级，定义验收标准与验证方法

## 验收原则

每条验收标准必须：
1. **可测量**：有明确的量化指标或判定条件
2. **可追溯**：能追溯到对应的 L3 规约与 L1 价值点
3. **可验证**：有明确的验证方法与工具

### L5 验收随 L4 阶段逐步填充

**说明**：L5 验收**随 L4 阶段逐步填充**——每完成一个 [workflow_stages](../03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml) 阶段，更新本目录下对应验收项与验证方法。L4 步骤文档可引用「本步骤完成后，在 L5 的 XX 表填写 YY 验收」。早期阶段（s0～s2）以**工程准出**为主（如单测通过、make test-docker 通过）；业务指标验收在 Phase1/Phase2 功能就绪后填入上表。

**验证结果与 L5 同步约定**：每个阶段**准出时须同步更新 L5**，避免 L4 填了、L5 未更新。具体约定：
- **同步目标**：本小节下表「DNA stage_id ↔ 阶段名称 ↔ 本阶段对应 L5 验收」中，该 stage 对应的一行；以及（若适用）下方「功能验收」「不可能三角验收」「工程性能验收」「质量验收」表中与本阶段相关的行。
- **执行方**：阶段目录内「验证结果记录」文档执行者或 AI 在勾选准出检查清单后，须在本文档（02_验收标准）中更新上表该行状态（如 ⏳→✅），并注明验证方式或链接。
- **引用**：各阶段目录内「验证结果记录」或准出检查清单须注明：「准出时须同步至：L5 [02_验收标准.md](02_验收标准.md) 中 workflow_stages 映射表对应行」。
- **与 DNA 强一致**：本表 workflow_stages 行集必须与 [dna_dev_workflow.yaml](../03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml) 的 `workflow_stages` 的 `stage_id` 一一对应；DNA 增删 stage 时须同步增删本表对应行。

**与 DNA 的约定**：下表表体（阶段名称、本阶段对应 L5 验收说明、消耗/产出）与 [dna_dev_workflow.yaml](../03_原子目标与规约/_System_DNA/dna_dev_workflow.yaml) 的 `workflow_stages` 强一致；可由脚本从 DNA 生成或做一致性校验。本表不设「状态」列，准出时由执行方在 06_ 追溯矩阵或阶段目录内勾选准出检查清单并注明验证方式；L5 文档仅保留本表结构及锚点，与 DNA 同步的静态内容以 DNA 为源。

下表「消耗/产出」与 DNA 一致，便于审计。每行锚点供 DNA `l5_stage_anchor` 与准出同步引用。

| 锚点 | DNA stage_id | 阶段名称 | 本阶段对应 L5 验收（或说明） | 消耗/产出（依赖与产出） |
|------|--------------|----------|------------------------------|--------------------------|
| <a id="l5-stage-s0_pre"></a>l5-stage-s0_pre | s0_pre | 仓库与 L3 就绪 | 工程：三仓目录符合 02_三位一体规约；diting-core 含 Makefile 且 make test 可运行（可为占位）。**验证记录**：已通过；验证方式：三仓目录存在、`make -C diting-core test` 退出码 0、diting-infra charts/config/observability/secrets 及 config/environments/dev/deploy.json 已初始化。 | 消耗：L3 规约与 DNA 定稿；产出：diting-core 目录与 Makefile、diting-infra 目录 |
| <a id="l5-stage-s0"></a>l5-stage-s0 | s0 | 本地骨架期 | 工程：核心接口存在、本地单测通过（无业务指标）。**验证记录**：已通过；验证方式 make test 全绿、目录与占位符合 DNA。 | 消耗：Stage0_pre 准出；产出：核心接口与占位实现、本地单测通过 |
| <a id="l5-stage-s1"></a>l5-stage-s1 | s1 | 逻辑填充期 | 工程：业务逻辑按 L3 与 5D 填充、单测+集成测试通过；功能验收表随 Phase 填充 | 消耗：Stage s0 准出；产出：Module A/B 骨架与 D/E 占位、单测与集成测试通过 |
| <a id="l5-stage-s1b"></a>l5-stage-s1b | s1b | Mock 数据验证准出 | 工程：Mock 路径跑通、无真实券商/LLM；无业务指标 | 消耗：Stage s1 准出；产出：Mock 路径跑通、Table-Driven Tests 通过 |
| <a id="l5-stage-s2"></a>l5-stage-s2 | s2 | Docker 统一环境期 | 工程：make build、make test-docker 通过 | 消耗：Stage s1 或 s1b 准出；产出：make build/test-docker 通过、镜像可构建 |
| <a id="l5-stage-s3"></a>l5-stage-s3 | s3 | K3s 测试开发期 | 工程：deploy-engine Up 成功、Helm release 存在；可选 E2E 验收 | 消耗：Stage s2 准出、diting-infra 已存在；产出：deploy-engine Up、Helm release 存在 |
| <a id="l5-stage-s4"></a>l5-stage-s4 | s4 | 与流水线衔接 | 工程：满足 Level 1 入口；业务验收与不可能三角表随 Phase 填充 | 消耗：Stage s3 准出；产出：Level 1 入口满足、可进入 merge develop / tag |

## 验收标准分类

### 功能验收

**与 DNA 的约定**：下表每行（锚点、能力规约、Phase/步骤、验收标准、验证方法）与 [global_const.yaml](../03_原子目标与规约/_System_DNA/global_const.yaml) 的 `product_scope.phases[].steps`（含 `l5_anchor`、`l5_acceptance_criterion`、`verification_method`）一致；可由脚本从 DNA 生成表体或做一致性校验。新增 Phase 步骤时只改 DNA 再生成/校验。**状态**列由对应 Phase 步骤 DoD 完成时更新。

以下按 Phase/步骤可追溯至 [01_需求与产品范围](../03_原子目标与规约/产品设计/01_需求与产品范围.md) 第四节 L1 价值点与 [09_核心模块架构规约](../03_原子目标与规约/09_核心模块架构规约.md)。**状态更新约定**：下表各行状态由对应 Phase 步骤**本步骤准出（DoD）**完成时更新；各步骤文档的 DoD 须引用**锚点**或「能力规约」列（如「已更新 L5 02_ 功能验收表 锚点 `l5-func-02`」或「…表中『09_ Module D』行」），执行准出时同步勾选并更新本表该行状态（⏳→✅）及验证方式。

| 锚点 | 能力规约 | Phase/步骤 | 验收标准 | 验证方法 | 状态 |
|------|---------|------------|---------|---------|------|
| `l5-func-01` | 09_ Module A/B | [Phase1_核心链路](../04_阶段规划与实践/Phase1_核心链路/) 01_ | Module A/B 目录与接口存在，量化信号可产出 | 单测或占位通过、接口契约满足；由 Phase1 01_ 准出时更新本行 | ⏳ |
| `l5-func-02` | 09_ Module D | Phase1 02_ | 判官投票+Kelly+Alpha 输出与 01_核心公式一致 | Table-Driven 单测、边界覆盖；由 Phase1 02_ 准出时更新本行 | ⏳ |
| `l5-func-03` | 09_ Module E | Phase1 03_ | 风控接口与占位（硬止损 2%、盈亏比≥1.5） | 单测或集成路径验证；由 Phase1 03_ 准出时更新本行 | ⏳ |
| `l5-func-04` | 09_ A→E 集成 | Phase1 04_ | A→B→D→E 最小路径可跑通，Mock/Table-Driven 可验证 | 集成测试或主路径执行；由 Phase1 04_ 准出时更新本行 | ⏳ |
| `l5-func-05` | 09_ Module C | [Phase2_MoE与执行网关](../04_阶段规划与实践/Phase2_MoE与执行网关/) 01_ | Router 按 Tag 分发，专家意见与 D 对接 | 单测/集成、Alpha 链路可执行；由 Phase2 01_ 准出时更新本行 | ⏳ |
| `l5-func-06` | 09_ Module F、05_接口抽象层 | Phase2 02_ | Broker 抽象与占位/仿真实现，E→F 衔接 | 单测或 place_order 调用验证；由 Phase2 02_ 准出时更新本行 | ⏳ |
| `l5-func-07` | 研产同构 | Phase2 03_ | Docker/K3s 下回测或仿真路径跑通 | 回测/仿真任务成功、结果可判定；由 Phase2 03_ 准出时更新本行 | ⏳ |
| `l5-func-08` | 08_心跳与健康检查、production_requirements.observability | [Phase3_优化与扩展](../04_阶段规划与实践/Phase3_优化与扩展/) 01_ | 日志/指标/健康检查满足 L3 | Prometheus 与健康端点验证；由 Phase3 01_ 准出时更新本行 | ⏳ |
| `l5-func-09` | cost_governance | Phase3 02_ | Token 预算与熔断逻辑可生效 | 配置读取与熔断路径验证；由 Phase3 02_ 准出时更新本行 | ⏳ |
| `l5-func-10` | Level 1 入口、L5 表 | Phase3 04_ | 满足三级流水线 Level 1、功能/不可能三角可追溯 | 入口条件核对、L5 表补齐 | ⏳ |

### 不可能三角验收（核心业务指标）

| 维度 | 指标 | 目标值 | 验证方法 | 状态 |
|------|------|--------|---------|------|
| **认知边界 (Certainty)** | 胜率（WinRate） | ≥ 75% | 回测统计（双重验证后目标 ≥ 80%） | ⏳ |
| **认知边界 (Certainty)** | 可解释标的占比 | ≥ 10% | 统计可解释逻辑的交易信号占比 | ⏳ |
| **复利增长 (Growth)** | 年化收益率（CAGR） | ≥ 30% | 回测与实盘统计 | ⏳ |
| **复利增长 (Growth)** | 现金拖累监控 | 空仓 > 5 天触发 | 监控系统日志 | ⏳ |
| **生存底线 (Survival)** | 最大回撤（MaxDD） | < 12% | 回测与实盘监控 | ⏳ |
| **生存底线 (Survival)** | 单笔风险 | < 2% | 风控模块日志 | ⏳ |
| **生存底线 (Survival)** | 盈亏比 | > 1.5 | 风控模块日志 | ⏳ |
| **生存底线 (Survival)** | Risk Shield 拦截率 | 100% | 高波动模拟测试 | ⏳ |

### 工程性能验收

| 指标 | 目标值 | 验证方法 | 状态 |
|------|--------|---------|------|
| 全市场扫描+推理耗时 | < 30 分钟 | 系统监控 | ⏳ |
| RTO（恢复时间目标） | < 5 分钟 | 故障演练 | ⏳ |
| API 响应时间 P95 | < 500ms | 压测工具 | ⏳ |
| API 响应时间 P99 | < 1000ms | 压测工具 | ⏳ |
| 可用性 | ≥ 99.9% | 监控系统 | ⏳ |

### 质量验收

| 指标 | 目标值 | 验证方法 | 状态 |
|------|--------|---------|------|
| 代码覆盖率 | ≥ 80% | 测试工具 | ⏳ |
| 静态分析 | 0 高危漏洞 | SonarQube | ⏳ |
| 核心公式实现 | Alpha = (Quant_Signal ∩ Router(Experts)) × Kelly_Position | 代码审查 | ⏳ |
| MoE 架构实现 | Router 动态选择专家 | 代码审查 + 测试 | ⏳ |

## 详细验收标准

→ 参见：
- [03_成功标识详细规约.md](./03_成功标识详细规约.md)（详细的技术规约）
- [04_验收标准通俗解释.md](./04_验收标准通俗解释.md)（通俗易懂的解释）

## 下一步

→ 参见 [06_追溯与审计/](../06_追溯与审计/) 目录下的追溯与审计文档
